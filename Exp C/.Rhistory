setwd("~/GitHub/Embryo-Predation-and-Parental-Care-on-Nocomis-Nests/Exp A")
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 6)
# Install required packages (run once)
packages <- c("readxl", "lme4", "lmerTest", "emmeans", "ggplot2", "dplyr")
# Check if packages are installed, install if not
new_packages <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(new_packages)) install.packages(new_packages)
# Load all packages
library(readxl)      # For reading Excel files
library(lme4)        # For mixed-effects models
library(lmerTest)    # For p-values with Satterthwaite approximation
library(emmeans)     # For post-hoc comparisons
library(ggplot2)     # For visualization
library(dplyr)       # For data manipulation
# Set options
options(prompt = "=")
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 6)
# Install required packages (run once)
packages <- c("readxl", "lme4", "lmerTest", "emmeans", "ggplot2", "dplyr")
# Check if packages are installed, install if not
new_packages <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(new_packages)) install.packages(new_packages)
# Load all packages
library(readxl)      # For reading Excel files
library(lme4)        # For mixed-effects models
library(lmerTest)    # For p-values with Satterthwaite approximation
library(emmeans)     # For post-hoc comparisons
library(ggplot2)     # For visualization
library(dplyr)       # For data manipulation
# Set options
options(prompt = "=")
# Read in excel sheet
data <- read_excel("parentalcare_data.xlsx")
# View data to check import
head(data)
# Convert categorical variables to factors
data$hpos <- as.factor(data$hpos)
data$vpos <- as.factor(data$vpos)
data$nest <- as.factor(data$nest)
# Check data structure
str(data)
summary(data)
# Check sample sizes for each combination
table(data$hpos, data$vpos)
#new data model
survival <- aov(percentsurvival ~ vpos * hpos + Error(nest) +Error(subsample),
data = data)
#new data model
survival <- aov(percentsurvival ~ vpos * hpos + Error(nest) + Error(subsample),
data = data)
#new data model
survival <- lmer(
percentsurvival ~ vpos * hpos +
(1 | nest) +
(1 | subsample),
data = data
)
anova(survival)
summary(survival)
survival2 <- lmer(
percentsurvival ~ vpos * hpos +
(1 | nest),
data = data
)
summary(survival2)
anova(survival2)
survival3 <- lmer(
percentsurvival ~ vpos * hpos +
(1 | nest/subsample),
data = data
)
summary(survival3)
anova(survival, type = 3)
anova(survival2, type = 3)
setwd("~/GitHub/Embryo-Predation-and-Parental-Care-on-Nocomis-Nests/Exp C")
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 6)
install.packages("knitr")
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 6)
# Install required packages (run once)
packages <- c("readxl", "lme4", "lmerTest", "emmeans", "ggplot2", "dplyr")
# Check if packages are installed, install if not
new_packages <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(new_packages)) install.packages(new_packages)
# Load all packages
library(readxl)      # For reading Excel files
library(lme4)        # For mixed-effects models
library(lmerTest)    # For p-values with Satterthwaite approximation
library(emmeans)     # For post-hoc comparisons
library(ggplot2)     # For visualization
library(dplyr)       # For data manipulation
# Set options
options(prompt = "=")
# Read in excel sheet
data <- read_excel("parentalcare_data.xlsx")
# View data to check import
head(data)
# Convert categorical variables to factors
data$hpos <- as.factor(data$hpos)
data$vpos <- as.factor(data$vpos)
data$nest <- as.factor(data$nest)
# Check data structure
str(data)
summary(data)
# Check sample sizes for each combination
table(data$hpos, data$vpos)
#new data model
survival <- lmer(
percentsurvival ~ vpos * hpos +
(1 | nest) +
(1 | subsample),
data = data
)
summary(survival)
anova(survival, type = 3)
survival2 <- lmer(
percentsurvival ~ vpos * hpos +
(1 | nest),
data = data
)
summary(survival2)
anova(survival2, type = 3)
# Model percent survival by pouch location
model <- lmer(percentsurvival ~ hpos * vpos + (1|nest), data = data)
summary(model)
#ANOVA table with F-tests
anova_results <- anova(model)
print(anova_results)
# Check model assumptions
par(mfrow = c(2, 2))
plot(model, main = "Residuals vs Fitted")
qqnorm(resid(model))
qqline(resid(model))
hist(resid(model), main = "Histogram of Residuals", xlab = "Residuals")
plot(fitted(model), sqrt(abs(resid(model))),
main = "Scale-Location", xlab = "Fitted values",
ylab = "sqrt(|Residuals|)")
#  QQ and residuals normality plots
res <- residuals(model)
res_df <- data.frame(residuals = res)
ggplot(res_df, aes(sample = residuals)) +
stat_qq() +
stat_qq_line(color = "red", linetype = "dashed") +
theme_bw() +
labs(title = "Normal Q-Q Plot of Residuals")
ggplot(res_df, aes(x = residuals)) +
geom_histogram(aes(y = ..density..), bins = 20, fill = "lightblue", color = "white") +
geom_density(color = "red", linewidth = 1) +
theme_bw() +
labs(title = "Histogram of Residuals", x = "Residuals", y = "Density")
# Calculate means and standard errors
means_table <- data %>%
group_by(vpos) %>%
summarise(
mean = mean(percentsurvival, na.rm = TRUE),
se = sd(percentsurvival, na.rm = TRUE) / sqrt(n()),
n = n()
)
print(means_table)
# Estimated marginal means for main effects and interaction
emmeans_vpos <- emmeans(model, ~ vpos)
print(summary(emmeans_vpos))
emmeans_hpos <- emmeans(model, ~ hpos)
print(summary(emmeans_hpos))
emmeans_interaction <- emmeans(model, ~ hpos * vpos)
print(summary(emmeans_interaction))
# Pairwise comparisons for vertical position
pairs_vpos <- pairs(emmeans_vpos, adjust = "tukey")
print(pairs_vpos)
# Pairwise comparisons for horizontal position
pairs_hpos <- pairs(emmeans_hpos, adjust = "tukey")
print(pairs_hpos)
# Pairwise comparisons for interaction
pairs_interaction <- pairs(emmeans_interaction, adjust = "tukey")
print(pairs_interaction)
# Create interaction plot
interaction_plot <- ggplot(data, aes(x = hpos, y = percentsurvival,
color = vpos, group = vpos)) +
stat_summary(fun = mean, geom = "point", size = 4) +
stat_summary(fun = mean, geom = "line", linewidth = 1) +
stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2,
linewidth = 1) +
labs(title = "Interaction: Horizontal Ã— Vertical Position on Embryo Survival",
x = "Horizontal Position",
y = "Percent Survival",
color = "Vertical Position") +
theme_bw(base_size = 14) +
theme(legend.position = "right")
print(interaction_plot)
boxplot <- ggplot(data, aes(x = hpos, y = percentsurvival, fill = vpos)) + geom_boxplot() +
theme_bw() + labs(title = "Percent Survival by Horizontal and Vertical Position")
print(boxplot)
setwd("~/GitHub/Embryo-Predation-and-Parental-Care-on-Nocomis-Nests/Exp C")
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 6)
# Install required packages (run once)
packages <- c("ggplot2", "dplyr", "AICcmodavg", "lme4")
# Check if packages are installed, install if not
new_packages <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(new_packages)) install.packages(new_packages)
# Load all packages
library(ggplot2)
library(dplyr)
library(AICcmodavg)
library(lme4)
# Set options
options(prompt = "=")
# Read in csv files and sort data
predation <- read.csv("eggstealing2023.csv")
# Read in csv files and sort data
predation <- read.csv("nestattendance_data.csv")
predation_s <- predation[order(predation$assoc_abund), ]
# plot mortality trend
ggplot(predation_s, aes(x = seq_along(mortality), y = mortality)) +
geom_point(color = "darkgrey") +
geom_smooth(method = "loess", span = 0.75, se = FALSE, color = "blue") +
labs(
title = "Smoothed Mortality (ordered by assoc_abund)",
x = "Observation index (sorted)",
y = "Mortality"
) +
theme_minimal(base_size = 14)
# plot mortality vs. associate abundance
ggplot(predation_s, aes(x = assoc_abund, y = mortality)) +
geom_point(color = "purple", alpha = 0.7, size = 2) +
geom_smooth(method = "loess", span = 0.75, se = TRUE, color = "black") +
labs(
title = "Mortality vs. Associated Abundance",
x = "Associated Abundance",
y = "Mortality"
) +
theme_minimal(base_size = 14)
# optional: subset and compare groups
# create combined groups as needed
up <- predation_s[which(predation_s$hpos=='up'),]
mid <- predation_s[which(predation_s$hpos=='mid'),]
down <- predation_s[which(predation_s$hpos=='down'),]
upmid <- filter(predation, hpos %in% c("up", "mid")) %>% arrange(assoc_abund)
updown <- filter(predation, hpos %in% c("up", "down")) %>% arrange(assoc_abund)
# example plots for these combined groups
ggplot(upmid, aes(x = assoc_abund, y = mortality)) +
geom_point(alpha = 0.6, color = "purple") +
geom_smooth(method = "loess", span = 0.75, se = FALSE, color = "black") +
labs(title = "Up + Mid Positions", x = "Associated Abundance", y = "Mortality") +
theme_minimal(base_size = 14)
ggplot(updown, aes(x = assoc_abund, y = mortality)) +
geom_point(alpha = 0.6, color = "darkgreen") +
geom_smooth(method = "loess", span = 0.75, se = FALSE, color = "black") +
labs(title = "Up + Down Positions", x = "Associated Abundance", y = "Mortality") +
theme_minimal(base_size = 14)
# Read in csv files and sort data
predation <- read.csv("nestattendance_data.csv")
predation_s <- predation[order(predation$assoc_abund), ]
# plot mortality trend
ggplot(predation_s, aes(x = seq_along(mortality), y = mortality)) +
geom_point(color = "darkgrey") +
geom_smooth(method = "loess", span = 0.75, se = FALSE, color = "blue") +
labs(
title = "Smoothed Mortality (ordered by assoc_abund)",
x = "Observation index (sorted)",
y = "Mortality"
) +
theme_minimal(base_size = 14)
# plot mortality vs. associate abundance
ggplot(predation_s, aes(x = assoc_abund, y = mortality)) +
geom_point(color = "purple", alpha = 0.7, size = 2) +
geom_smooth(method = "loess", span = 0.75, se = TRUE, color = "black") +
labs(
title = "Mortality vs. Associated Abundance",
x = "Associated Abundance",
y = "Mortality"
) +
theme_minimal(base_size = 14)
# optional: subset and compare groups
# create combined groups as needed
up <- predation_s[which(predation_s$hpos=='up'),]
mid <- predation_s[which(predation_s$hpos=='mid'),]
down <- predation_s[which(predation_s$hpos=='down'),]
upmid <- filter(predation, hpos %in% c("up", "mid")) %>% arrange(assoc_abund)
updown <- filter(predation, hpos %in% c("up", "down")) %>% arrange(assoc_abund)
# example plots for these combined groups
ggplot(upmid, aes(x = assoc_abund, y = mortality)) +
geom_point(alpha = 0.6, color = "purple") +
geom_smooth(method = "loess", span = 0.75, se = FALSE, color = "black") +
labs(title = "Up + Mid Positions", x = "Associated Abundance", y = "Mortality") +
theme_minimal(base_size = 14)
ggplot(updown, aes(x = assoc_abund, y = mortality)) +
geom_point(alpha = 0.6, color = "darkgreen") +
geom_smooth(method = "loess", span = 0.75, se = FALSE, color = "black") +
labs(title = "Up + Down Positions", x = "Associated Abundance", y = "Mortality") +
theme_minimal(base_size = 14)
pred0 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID), family=binomial(link="logit"), data=predation)
pred1 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ assoc_abund + hpos + subsample,
family=binomial(link="logit"), data=predation)
pred2 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ hpos + subsample,
family=binomial(link="logit"), data=predation)
pred3 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ assoc_abund + subsample,
family=binomial(link="logit"), data=predation)
summary(pred0)
summary(pred1)
summary(pred2)
summary(pred3)
pred01 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID), family=binomial(link="logit"), data=updown)
pred11 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ assoc_abund + hpos + subsample,
family=binomial(link="logit"), data=updown)
summary(pred11)
pred02 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID),
family=binomial(link="logit"), data=up)
pred12 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ assoc_abund +
subsample,
family=binomial(link="logit"), data=up)
summary(pred12)
Cand.models <- list(pred0,pred1,pred2,pred3)
Modnames <- c("Null Model", "Full Model", "No assoc abundance Model", "No horizontal position Model")
print(aictab(cand.set = Cand.models, modnames = Modnames, second.ord = TRUE), digits = 2)
# Check singularity
cat("Singularity check embryo predation models:", sapply(Cand.models, isSingular), "\n")
ggplot(predation, aes(x = factor(hpos), y = pct_mort)) +
geom_boxplot(fill = "blueviolet", color = "black") +
labs(title = "Egg mortality by horizontal position",
x = "Horizontal position",
y = "Egg mortality (%)") +
theme_classic() +
theme(text = element_text(size = 18),
axis.text = element_text(size = 18),
axis.title = element_text(size = 18),
plot.title = element_text(size = 18))
pkgs <- c("lme4")
lapply(pkgs, citation)
pred0 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID), family=binomial(link="logit"), data=predation)
pred1 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ assoc_abund + hpos + (1|subsample),
family=binomial(link="logit"), data=predation)
pred2 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ hpos + (1|subsample),
family=binomial(link="logit"), data=predation)
pred3 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ assoc_abund + (1|subsample),
family=binomial(link="logit"), data=predation)
summary(pred0)
summary(pred1)
summary(pred2)
summary(pred3)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 6)
# Install required packages (run once)
packages <- c("ggplot2", "dplyr", "AICcmodavg", "lme4")
# Check if packages are installed, install if not
new_packages <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(new_packages)) install.packages(new_packages)
# Load all packages
library(ggplot2)
library(dplyr)
library(AICcmodavg)
library(lme4)
# Set options
options(prompt = "=")
# Read in csv files and sort data
predation <- read.csv("nestattendance_data.csv")
predation_s <- predation[order(predation$assoc_abund), ]
# plot mortality trend
ggplot(predation_s, aes(x = seq_along(mortality), y = mortality)) +
geom_point(color = "darkgrey") +
geom_smooth(method = "loess", span = 0.75, se = FALSE, color = "blue") +
labs(
title = "Smoothed Mortality (ordered by assoc_abund)",
x = "Observation index (sorted)",
y = "Mortality"
) +
theme_minimal(base_size = 14)
# plot mortality vs. associate abundance
ggplot(predation_s, aes(x = assoc_abund, y = mortality)) +
geom_point(color = "purple", alpha = 0.7, size = 2) +
geom_smooth(method = "loess", span = 0.75, se = TRUE, color = "black") +
labs(
title = "Mortality vs. Associated Abundance",
x = "Associated Abundance",
y = "Mortality"
) +
theme_minimal(base_size = 14)
# optional: subset and compare groups
# create combined groups as needed
up <- predation_s[which(predation_s$hpos=='up'),]
mid <- predation_s[which(predation_s$hpos=='mid'),]
down <- predation_s[which(predation_s$hpos=='down'),]
upmid <- filter(predation, hpos %in% c("up", "mid")) %>% arrange(assoc_abund)
updown <- filter(predation, hpos %in% c("up", "down")) %>% arrange(assoc_abund)
# example plots for these combined groups
ggplot(upmid, aes(x = assoc_abund, y = mortality)) +
geom_point(alpha = 0.6, color = "purple") +
geom_smooth(method = "loess", span = 0.75, se = FALSE, color = "black") +
labs(title = "Up + Mid Positions", x = "Associated Abundance", y = "Mortality") +
theme_minimal(base_size = 14)
ggplot(updown, aes(x = assoc_abund, y = mortality)) +
geom_point(alpha = 0.6, color = "darkgreen") +
geom_smooth(method = "loess", span = 0.75, se = FALSE, color = "black") +
labs(title = "Up + Down Positions", x = "Associated Abundance", y = "Mortality") +
theme_minimal(base_size = 14)
pred0 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID), family=binomial(link="logit"), data=predation)
pred1 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ assoc_abund + hpos + (1|subsample),
family=binomial(link="logit"), data=predation)
pred2 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ hpos + (1|subsample),
family=binomial(link="logit"), data=predation)
pred3 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ assoc_abund + (1|subsample),
family=binomial(link="logit"), data=predation)
summary(pred0)
summary(pred1)
summary(pred2)
summary(pred3)
pred01 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID), family=binomial(link="logit"), data=updown)
pred11 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ assoc_abund + hpos + subsample,
family=binomial(link="logit"), data=updown)
summary(pred11)
pred02 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID),
family=binomial(link="logit"), data=up)
pred12 <- glmer(cbind(mortality, bait_ct-mortality) ~ (1|nestID)+ assoc_abund +
subsample,
family=binomial(link="logit"), data=up)
summary(pred12)
Cand.models <- list(pred0,pred1,pred2,pred3)
Modnames <- c("Null Model", "Full Model", "No assoc abundance Model", "No horizontal position Model")
print(aictab(cand.set = Cand.models, modnames = Modnames, second.ord = TRUE), digits = 2)
# Check singularity
cat("Singularity check embryo predation models:", sapply(Cand.models, isSingular), "\n")
ggplot(predation, aes(x = factor(hpos), y = pct_mort)) +
geom_boxplot(fill = "blueviolet", color = "black") +
labs(title = "Egg mortality by horizontal position",
x = "Horizontal position",
y = "Egg mortality (%)") +
theme_classic() +
theme(text = element_text(size = 18),
axis.text = element_text(size = 18),
axis.title = element_text(size = 18),
plot.title = element_text(size = 18))
Cand.models <- list(pred0,pred1,pred2,pred3)
Modnames <- c("Null Model", "Full Model", "No assoc abundance Model", "No horizontal position Model")
print(aictab(cand.set = Cand.models, modnames = Modnames, second.ord = TRUE), digits = 2)
# Check singularity
cat("Singularity check embryo predation models:", sapply(Cand.models, isSingular), "\n")
ggplot(predation, aes(x = factor(hpos), y = pct_mort)) +
geom_boxplot(fill = "blueviolet", color = "black") +
labs(title = "Egg mortality by horizontal position",
x = "Horizontal position",
y = "Egg mortality (%)") +
theme_classic() +
theme(text = element_text(size = 18),
axis.text = element_text(size = 18),
axis.title = element_text(size = 18),
plot.title = element_text(size = 18))
Cand.models <- list(pred0,pred1,pred2,pred3)
Modnames <- c("Null Model", "Full Model", "No assoc abundance Model", "No horizontal position Model")
print(aictab(cand.set = Cand.models, modnames = Modnames, second.ord = TRUE), digits = 2)
# Check singularity
cat("Singularity check embryo predation models:", sapply(Cand.models, isSingular), "\n")
ggplot(predation, aes(x = factor(hpos), y = pct_mort)) +
geom_boxplot(fill = "blueviolet", color = "black") +
labs(title = "Egg mortality by horizontal position",
x = "Horizontal position",
y = "Egg mortality (%)") +
theme_classic() +
theme(text = element_text(size = 18),
axis.text = element_text(size = 18),
axis.title = element_text(size = 18),
plot.title = element_text(size = 18))
summary(pred1)
#print Table 3 stats
est  <- fixef(pred1)
wald <- confint(pred1, parm = "beta_", method = "Wald")
cbind(Estimate = est, wald)
summary(pred1)
